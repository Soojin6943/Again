
{% block content %}

{{ category }}
{{ centerLat }} {{ centerLon }}
<div id="map" style="width:100%; height:800px;"></div>
<script type="text/javascript" src="//dapi.kakao.com/v2/maps/sdk.js?appkey=77ce1142d1174a7bb72f1d47e3db5670&libraries=services"></script>
<script>
    var container = document.getElementById('map');  //지도를 표시 할 div
    var options = {
        center: new kakao.maps.LatLng(33.450701, 126.570667),  // 지도의 중심 좌표
        level: 6  // 지도 확대 레벨
    };
    var map = new kakao.maps.Map(container, options);   // 지도 생성

    // 지도 확대 축소를 제어할 수 있는  줌 컨트롤을 생성합니다
    var zoomControl = new kakao.maps.ZoomControl();
    map.addControl(zoomControl, kakao.maps.ControlPosition.RIGHT);

    var geocoder = new kakao.maps.services.Geocoder();

    var positions = new Array();

    // 데이터들 넣기
    {% for mapL in mapList %}
        positions.push({
            title: '{{ mapL.title }}',
            address: '{{ mapL.location }}'
           })
    {% endfor %}

    positions.forEach(function (position) {
        geocoder.addressSearch(position.address, function(result, status) {

            if(status === kakao.maps.services.Status.OK) {
                var coords = new kakao.maps.LatLng(result[0].y, result[0].x);

                var marker = new kakao.maps.Marker({
                    map: map, // 마커 표시할 지도
                    position: coords,  // 마커 표시할 위치
                    clickable: true
                });

                var iwContent = '<div style="width:150px; text-align:center; padding:6px 0;">' + position.title + '</div>',
                    iwRemoveable = true;

                var infowindow = new kakao.maps.InfoWindow({
                   content : iwContent,
                   removable : iwRemoveable
                });


                kakao.maps.event.addListener(marker, 'click', function() {
                    infowindow.open(map, marker);
                });

            if (navigator.geolocation) { // HTML5로 geolocation 사용 여부 확인

                // GeoLocation 이용해서 접속 위치 얻기
                navigator.geolocation.getCurrentPosition(function(position) {
                    var lat = position.coords.latitude, // 위도
                    lon = position.coords.longitude; // 경도

                    var locPosition = new kakao.maps.LatLng(lat, lon);
                });
            } else { // 사용할 수 없을 경우
                var locPosition = new kakao.maps.LatLng(33.450701, 126.570667);
            }

            map.setCenter(locPosition);

                //map.setCenter(coords);
            }
        });
    });

</script>
{% endblock %}